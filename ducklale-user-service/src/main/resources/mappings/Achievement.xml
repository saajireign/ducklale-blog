<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">



<mapper namespace="com.ducklale.user.domain.dao.AchievementDao">

	<!-- 映射结果集 -->
	<resultMap id="achievementResultMap" type="com.ducklale.user.domain.entity.AchievementPO">
		<id property="id" column="id" jdbcType="INTEGER"/>
    	<result property="achievementName" column="achievement_name" jdbcType="VARCHAR"/>
    	<result property="achievementDescription" column="achievement_description" jdbcType="VARCHAR"/>
    	<result property="achievementPoints" column="achievement_points" jdbcType="INTEGER"/>
		<result property="achievementGrade" column="achievement_grade" jdbcType="INTEGER"/>
	</resultMap>
	
	<!-- 用于select查询公用抽取的列 -->
	<sql id="achievementColumnList">
	    <![CDATA[
			id,achievement_name,achievement_description,achievement_points,achievement_grade
	    ]]>
	</sql>

	<sql id="taAchievementColumnList">
		<![CDATA[
			ta.id,ta.achievement_name,ta.achievement_description,ta.achievement_points,ta.achievement_grade
	    ]]>
	</sql>

	<!-- 根据条件查询 -->
	<select id="queryPageCount" resultType="java.lang.Integer"   parameterType="com.ducklale.user.api.dto.query.AchievementQuery">
		SELECT count(*)
		<![CDATA[
	    FROM t_achievement
	    ]]>
		<where>
			1=1
			<if test="achievementName != null">
			</if>
			<if test="achievementName != null">
				AND achievement_name like concat('%',#{achievementName,jdbcType=VARCHAR},'%')
			</if>
			<if test="achievementDescription != null">
				AND achievement_description like concat('%',#{achievementDescription,jdbcType=VARCHAR},'%')
			</if>
			<if test="achievementGrade != null">
				AND achievement_grade = #{achievementGrade,jdbcType=VARCHAR}
			</if>

		</where>
	</select>

	<select id="queryPage" resultMap="achievementResultMap"  parameterType="com.ducklale.user.api.dto.query.AchievementQuery">
		SELECT <include refid="achievementColumnList" />
		<![CDATA[
	    FROM t_achievement
	    ]]>
		<where>
			1=1
			<if test="achievementName != null">
				AND achievement_name like concat('%',#{achievementName,jdbcType=VARCHAR},'%')
			</if>
			<if test="achievementDescription != null">
				AND achievement_description like concat('%',#{achievementDescription,jdbcType=VARCHAR},'%')
			</if>
			<if test="achievementGrade != null">
				AND achievement_grade = #{achievementGrade,jdbcType=VARCHAR}
			</if>
		</where>
		limit #{offset},#{limit}

	</select>
	<!-- 根据主键查询 -->
	<select id="selectById" resultMap="achievementResultMap"  parameterType="java.lang.Integer">
		SELECT <include refid="achievementColumnList" />
	    <![CDATA[
	    FROM t_achievement 
        WHERE 
	        id = #{id,jdbcType=INTEGER}
	    ]]>
	</select>
	<select id="getUserAchievements" resultMap="achievementResultMap"  parameterType="java.lang.Long">
		SELECT <include refid="taAchievementColumnList" />
		<![CDATA[
	    FROM t_rel_user_achievement tra  left outer join t_achievement ta on ta.id = tra.achievement_id
        ]]>
		<where>
			 tra.user_id = #{userId,jdbcType=INTEGER}
		</where>
	</select>

	
	<!-- 根据ID删除 -->
    <delete id="deleteById"  parameterType="java.lang.String">
	    <![CDATA[
	        DELETE FROM t_achievement 
	        WHERE
	        id = #{id,jdbcType=INTEGER}
	    ]]>
    </delete>
   
  	
  	<!-- 根据参数对象中有值的进行插入-->
	<insert id="insert" parameterType="com.ducklale.user.domain.entity.AchievementPO" >
		insert into t_achievement
		<trim prefix="(" suffix=")" suffixOverrides="," >
	     	<if test="id != null" >
		    id,
		  	</if>
	     	<if test="achievementName != null" >
		    achievement_name,
		  	</if>
	     	<if test="achievementDescription != null" >
		    achievement_description,
		  	</if>
	     	<if test="achievementPoints != null" >
		    achievement_points,
		  	</if>
			<if test="achievementGrade != null" >
				achievement_grade,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides="," >
	     	<if test="id != null" >
		    #{id,jdbcType=INTEGER},
		  	</if>
	     	<if test="achievementName != null" >
		    #{achievementName,jdbcType=VARCHAR},
		  	</if>
	     	<if test="achievementDescription != null" >
		    #{achievementDescription,jdbcType=VARCHAR},
		  	</if>
	     	<if test="achievementPoints != null" >
		    #{achievementPoints,jdbcType=INTEGER},
		  	</if>
			<if test="achievementGrade != null" >
				#{achievementGrade,jdbcType=INTEGER},
			</if>

		</trim>
	</insert>
	
	
	<!-- 根据ID进行更新 -->
	<update id="updateById"  parameterType="com.ducklale.user.domain.entity.AchievementPO">
		update t_achievement
		<set>
			<if test="id != null" >
			 id = #{id,jdbcType=INTEGER},
			</if>
			<if test="achievementName != null" >
			 achievement_name = #{achievementName,jdbcType=VARCHAR},
			</if>
			<if test="achievementDescription != null" >
			 achievement_description = #{achievementDescription,jdbcType=VARCHAR},
			</if>
			<if test="achievementPoints != null" >
			 achievement_points = #{achievementPoints,jdbcType=INTEGER},
			</if>
			<if test="achievementGrade != null" >
				#{achievementGrade,jdbcType=INTEGER},
			</if>
		</set>
		where
			id = #{id,jdbcType=INTEGER}
	</update>
	<insert id="insertBatch">
		INSERT INTO t_achievement (achievement_name,achievement_description,achievement_points,achievement_grade)
		VALUES
		<foreach collection="list" item="rel" separator=",">
			(#{rel.achievementName,jdbcType=VARCHAR},#{rel.achievementDescription,jdbcType=VARCHAR}, #{rel.achievementPoints,jdbcType=INTEGER}, #{rel.achievementGrade,jdbcType=INTEGER})
		</foreach>
	</insert>
</mapper>

